<!DOCTYPE html>
<html lang="zh">
<head>
    <title>Linefusion电力线点云自动化处理系统</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" href="css/style.css" type="text/css">
    <style>
        /*!* Open Sans 字体定义 *!*/
        /*@font-face {*/
        /*    font-family: 'Open Sans';*/
        /*    font-style: normal;*/
        /*    font-weight: 400;*/
        /*    src: local('Open Sans Regular'), local('OpenSans-Regular'),*/
        /*    url('fonts/OpenSans-Regular.woff2') format('woff2'),*/
        /*    url('fonts/OpenSans-Regular.woff') format('woff');*/
        /*}*/

        /*@font-face {*/
        /*    font-family: 'Open Sans';*/
        /*    font-style: normal;*/
        /*    font-weight: 700;*/
        /*    src: local('Open Sans Bold'), local('OpenSans-Bold'),*/
        /*    url('fonts/OpenSans-Bold.woff2') format('woff2'),*/
        /*    url('fonts/OpenSans-Bold.woff') format('woff');*/
        /*}*/

        /*!* Archivo Black 字体定义 *!*/
        /*@font-face {*/
        /*    font-family: 'Archivo Black';*/
        /*    font-style: normal;*/
        /*    font-weight: 400;*/
        /*    src: local('Archivo Black Regular'), local('ArchivoBlack-Regular'),*/
        /*    url('fonts/ArchivoBlack-Regular.woff2') format('woff2'),*/
        /*    url('fonts/ArchivoBlack-Regular.woff') format('woff');*/
        /*}*/
    </style>
    <style>
        #loader-wrapper {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9999; /* 确保在最顶层 */
            background-image: linear-gradient(to right, #FFFFE0 0%, #FFE4E1 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            /* 设置过渡效果，用于平滑淡出 */
            transition: opacity 0.8s ease-out;
            opacity: 1;
        }

        #loader-wrapper img {
            max-width: 600px;
            border: 2px solid #D3D3D3;
            width: 50%;
        }

        /* 这个类将由JS添加，用于隐藏加载画面 */
        #loader-wrapper.hidden {
            opacity: 0;
            /* 隐藏后不再响应鼠标事件 */
            pointer-events: none;
        }
        #fit-console-output {
            background-color: #2b2b2b;
            color: #f0f0f0;
            font-family: monospace;
            padding: 10px;
            border-radius: 4px;
            height: 150px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 12px;
            user-select: text !important; /* 允许用户选择和复制文本, !important 提升优先级 */
            -webkit-user-select: text !important; /* 兼容旧版 Webkit 内核 */
            cursor: text; /* 鼠标光标变为文本输入样式 */
        }
    </style>
</head>
<body data-custom-load="true" data-name="plasio_laszip"
      data-tools="" data-configs="" data-path="">

<div id="loader-wrapper">
    <img src="images/LineFusionPro.png" alt="正在加载 LineFusion...">
</div>
<div id="progressBar" style="display: none">
</div>

<div class="drag-and-drop" style="display: none">
    <div class="title">
        在此放置文件！
    </div>
</div>
<div class="ui-layout-center">
    <div id="container"></div>
    <div id="fps"></div>
    <div id="messages"></div>
    <div id="pointCount"></div>
    <div id="credits" style="display: none"></div>
</div>
<div class="ui-layout-east">
    <input id="filebrowser" type="file" style="display:none" multiple>
    <div id="mainActions">
        <div class="title">
            <h1>LineFusion</h1>
        </div>
        <div class="section">
            <div id="webglinfo" style="display: none"> </div>
            <div class="p-head">
                <h3>文件</h3>
            </div>
            <div class="p-body">
                <div id="naclerror" style="display: none"> </div>
                <div class="labeled-controls">
                    <h4>选择要显示的数据</h4>
                    <h5>选择您自己的文件。</h5>
                    <div class="btn-group btn-block" id="browse">
                        <button type="button" class="btn btn-default btn-sm btn-file dropdown-lead">
                            浏览
                        </button>
                    </div>
                    <div id="loadingStatus" class="pull-left"></div>
                </div>

                <div class="labeled-controls">
                    <h4>密度</h4>
                    <h5>设置加载密度。数值越小，加载和显示越快。重新打开文件以应用新密度。</h5>
                    <div id="loadFidelity"></div>
                </div>
                <div id="loadError"></div>
                <div class="props" style="display:none">
                    <div class="labeled-controls">
                        <h4>比例对象</h4>
                        <h5 class='switch-inst'>在多个数据集之间切换</h5>
                        <div id="multi-files"></div>
                        <div class="auto-play" style="display: none">
                            <h5>调整滑块以自动切换文件</h5>
                            <div id="playback-rate"></div>
                            <div id='playback-fps'></div>
                        </div>
                        <table class="table">
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="p-head">
                <h3>电力线处理流程</h3>
            </div>
            <div class="p-body">
                <div class="labeled-controls">
                    <h4>1. 电力线与地面粗提取</h4>
                    <h5>运行脚本，将地面点与非地面点（潜在电力线）分离。</h5>
                    <button type="button" class="btn btn-primary btn-block" id="run-step1-btn" disabled>
                        <span class="btn-text">运行粗提取</span>
                        <span class="spinner" style="display: none;"></span>
                    </button>
                    <small id="step1-status" class="status-text"></small>
                </div>
                <div class="labeled-controls">
                    <h4>2. 电塔提取和电力线分段</h4>
                    <h5>识别电塔，并对导线进行分段和拓扑发现。</h5>
                    <button type="button" class="btn btn-info btn-block" id="run-step2-btn" disabled>
                        <span class="btn-text">运行电塔和分段</span>
                        <span class="spinner" style="display: none;"></span>
                    </button>
                    <small id="step2-status" class="status-text"></small>
                </div>
                <div class="labeled-controls">
                    <h4>运行日志</h4>
                    <h5>实时显示电力线处理脚本的运行过程。</h5>
                    <pre id="fit-console-output"></pre>
                </div>
                <div class="labeled-controls">
                    <h4>属性信息</h4>
                    <div id="properties-content">
                    </div>
                </div>
            </div>
        </div>
        <div class="section">
            <div class="p-head">
                <h3>相机</h3>
            </div>
            <div class="p-body">
                <div class="labeled-controls">
                    <h4>类型</h4>
                    <h5>透视相机提供 3D 视图，而正交和顶视相机提供正交视图</h5>
                    <div class="btn-group btn-group-sm btn-block" id="camera-type-group">
                        <button type="button" class="btn btn-default" id="perspective">透视</button>
                        <button type="button" class="btn btn-default" id="ortho">正交</button>
                        <button type="button" class="btn btn-default" id="top-view">顶视图</button>
                    </div>
                    <h4 class="not-first">重置</h4>
                    <h5>将视图恢复到初始状态</h5>
                    <button type="button" class="btn btn-sm btn-default btn-block" id="camera-reset">重置视图</button>
                    <h4 class="not-first">视场</h4>
                    <h5>更改视场会产生有趣的效果，仅适用于透视相机</h5>
                    <div id="fov"></div>
                </div>

                <div class="labeled-controls">
                    <h4>裁剪区域</h4>
                    <h5>选择查看数据的替代方式</h5>
                    <div id="clipping-regions"></div>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="p-head">
                <h3>数据</h3>
            </div>
            <div class="p-body">
                <div class="labeled-controls" id="points-list">
                    <h4>测量</h4>
                    <h5>当前在视区内的测量段</h5>
                    <button type="button" class="btn btn-sm btn-default btn-block" id="mensuration-reset">重置</button>
                    <div id="points-list-table">
                    </div>
                </div>
                <div class="labeled-controls">
                    <h4>粒子大小</h4>
                    <h5>较大尺寸填充显示</h5>
                    <div id="pointsize"></div>
                </div>
                <div class="labeled-controls">
                    <h4>Z-夸大</h4>
                    <h5>较高的值使得高程差异更加明显</h5>
                    <div id="zscale"></div>
                </div>
                <div class="labeled-controls">
                    <h4>着色</h4>
                    <h5>选择一个属性进行着色</h5>
                    <div class="btn-group btn-block" id="colorsource">
                        <button type="button" class="btn btn-sm btn-default btn-block dropdown-toggle" data-toggle="dropdown" target="rgb">
                            RGB <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu btn-block" role="menu">
                            <li><a href="#rgb">RGB</a></li>
                            <li><a href="#classification">分类</a></li>
                            <li><a class="default-if-no-color" href="#heightmap-color">高度图颜色</a></li>
                            <li><a href="#heightmap-color-inv">高度图颜色反转</a></li>
                        </ul>
                    </div>
                </div>
                <div class="labeled-controls">
                    <h4>颜色映射</h4>
                    <h5>用于高度图颜色和分类颜色源的颜色渐变值</h5>
                    <div class='btn-group btn-group-justified' id="colorSwatches">
                        <a type="button" class="btn btn-default btn-sm">
                            <img src="colormaps/blue-red.png" width="100%" height="10">
                        </a>
                        <a type="button" class="btn btn-default btn-sm">
                            <img src="colormaps/blue-hue.png" width="100%" height="10">
                        </a>
                        <a type="button" class="btn btn-default btn-sm">
                            <img src="colormaps/blue-orange.png" width="100%" height="10">
                        </a>
                        <a type="button" class="btn btn-default btn-sm">
                            <img src="colormaps/heat-map.png" width="100%" height="10">
                        </a>
                        <a type="button" class="btn btn-default btn-sm">
                            <img src="colormaps/awesome-green.png" width="100%" height="10">
                        </a>
                        <a type="button" class="btn btn-default btn-sm">
                            <img src="colormaps/pestel-shades.png" width="100%" height="10">
                        </a>
                        <a type="button" class="btn btn-default btn-sm">
                            <img src="colormaps/black-orange.png" width="100%" height="10">
                        </a>
                    </div>
                    <div id="colorCanvas">
                        <canvas id="colorCanvasObject"></canvas>
                    </div>
                    <div id="colormapClamp"></div>
                </div>
                <div class="labeled-controls">
                    <h4>强度源</h4>
                    <h5>颜色调制器，可以进行调制</h5>
                    <div class="btn-group btn-block" id="intensitysource">
                        <button type="button" class="btn btn-sm btn-default btn-block dropdown-toggle" data-toggle="dropdown" target="intensity">
                            强度 <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu btn-block" role="menu">
                            <li><a href="#intensity">强度</a></li>
                            <li><a href="#heightmap">高度图灰度</a></li>
                            <li><a href="#heightmap-inv">高度图灰度反转</a></li>
                        </ul>
                    </div>
                </div>
                <div class="labeled-controls">
                    <h4>强度混合</h4>
                    <h5>与颜色混合的强度</h5>
                    <div id="blending"></div>
                    <div class="clearfix blend-factor">
                        <div class="pull-left">全色</div>
                        <div class="pull-right">全强度</div>
                    </div>
                </div>
                <div class="labeled-controls">
                    <h4>强度缩放</h4>
                    <h5>缩小到一系列强度值，仅适用于从点源获取的强度值</h5>
                    <div id="intensity"></div>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="p-head">
                <h3>工具</h3>
            </div>
            <div class="p-body">
                <div class="labeled-controls">
                    <h4>淹没</h4>
                    <h5>启用淹没平面并使用滑块进行操作</h5>
                    <div id="inun-container"></div>
                </div>
                <div class="labeled-controls">
                    <h4>危险区域标记</h4>
                    <h5>危险区域标记工具，用于标记危险区域</h5>
                    <div id="danger-zone-controls"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="listener"></div>
<div class="modal fade" id="propertiesModal" tabindex="-1" role="dialog" aria-labelledby="propertiesModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="propertiesModalLabel">电力线属性信息</h4>
            </div>
            <div class="modal-body" id="propertiesModalBody">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
            </div>
        </div>
    </div>
</div>


<!--<script src="bad.js"></script>-->
<!--<script src="client.js"></script>-->
<!-- Modal -->
<div class="modal fade" id="creditsPage" tabindex="-1" role="dialog" aria-labelledby="creditsPageModal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title">Linefusion 数据来源</h4>

            </div>
            <div class="modal-body">
                <h4>以下数据文件需按原始来源进行致谢</h4>
                <ul>
                    <li>Autzen 体育场 -- <a href="http://www.linkedin.com/pub/aaron-reyna/82/619/894">Aaron Reyna</a>, <a href="http://www.watershedsciences.com/">Watershed Sciences, Inc.</a>
                    </li>
                    <li>圣海伦斯山 -- <a href="http://www.linkedin.com/in/howardbutler">Howard Butler</a>, <a href="http://hobu.co">Hobu, Inc.</a>. USGS LiDAR + NAIP.
                    </li>
                    <li>半圆顶 -- <a href="http://www.linkedin.com/in/howardbutler">Howard Butler</a>, <a href="http://hobu.co">Hobu, Inc.</a> USGS LiDAR + NAIP.
                    </li>

                    <li>航天飞机 -- 数据由史密森国家航空航天博物馆、史蒂文·F·乌德瓦尔-哈齐中心和美国陆军工程兵团提供，  <a href="http://www.crrel.usace.army.mil/">冷地区研究与工程实验室</a>.
                    </li>
                    <li>爱荷华州福尔斯市，大学大道 -- 爱荷华州交通部</li>
                </ul>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>

<!-- Modal -->
<div class="modal fade" id="openGreyhoundModal" tabindex="-1" role="dialog" aria-labelledby="openGreyhoundPage" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title">打开 Greyhound 源</h4>

            </div>
            <div class="modal-body ui-panel">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-warning" data-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-primary">打开管道</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>



<!-- Modal -->
<div class="modal fade" id="scalesPage" data-keyboard="false" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="scalesPageLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">指定投影</h4>
            </div>
            <div class="modal-body">
                <div style='text-align: center;padding-bottom: 10px;'>
                    <h4 style="font-weight: bold">数据似乎不在投影坐标系中。</h4>
                    <h4 style="color:#999">请选择您想要的操作：</h4>
                </div>
                <button type="button" class="btn btn-primary btn-lg btn-block" data-value="0">保持不变</button>
                <button type="button" class="btn btn-success btn-lg btn-block" data-value="1">将 X/Y 缩放到米，Z 以米为单位</button>
                <button type="button" class="btn btn-info btn-lg btn-block" data-value="2">将 X/Y 缩放到米，Z 以英尺为单位</button>
            </div>
            <div class="modal-footer">
                <!-- <button type="button" class="btn btn-default" data-dismiss="modal">Close</button> -->
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>

<!-- Modal -->
<div class="modal fade" id="docsPage" tabindex="-1" role="dialog" aria-labelledby="scalesPageLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title">LineFusion 文档</h4>
            </div>
            <div class="modal-body">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>

<script src="bad.js"></script>
<script src="client.js"></script>
<script type="x-shader/x-vertex" id="vertexshader">
    uniform float pointSize;
    uniform float intensityBlend;
    uniform float maxColorComponent;

    uniform float rgb_f;
    uniform float intensity_f;
    uniform float class_f;
    uniform float height_f;
    uniform float iheight_f;
    uniform float map_f;
    uniform float imap_f;

    uniform vec3 xyzScale;

    uniform float clampLower;
    uniform float clampHigher;
    uniform float colorClampLower;
    uniform float colorClampHigher;
    uniform vec2  zrange;
    uniform vec3  offsets;
    uniform sampler2D map;
    uniform vec2  klassRange;

    attribute vec3 color;
    attribute float intensity;
    attribute float classification;

    varying vec4 col;
    varying vec3 fpos;


    void main() {
        fpos = ((position.xyz - offsets) * xyzScale).xzy * vec3(-1, 1, 1);

        vec4 mvPosition = modelViewMatrix * vec4( fpos, 1.0 );
        gl_Position = projectionMatrix * mvPosition;
        float nheight = (position.z - zrange.x) / (zrange.y - zrange.x);

        float nhclamp = (nheight - colorClampLower) / (colorClampHigher - colorClampLower);

        // compute color channels
        //
        vec3 norm_color = color / maxColorComponent;
        vec3 map_color = texture2D(map, vec2(nhclamp, 0.5)).rgb;
        vec3 inv_map_color = texture2D(map, vec2(1.0 - nhclamp, 0.5)).rgb;

        float iklass = (classification - klassRange.x) / (klassRange.y - klassRange.x);
        vec3 class_color = texture2D(map, vec2(iklass, 0.5)).rgb;

        // compute intensity channels
        float i = (intensity - clampLower) / (clampHigher - clampLower);
        vec3 intensity_color = vec3(i, i, i);


        vec3 height_color = vec3(nheight, nheight, nheight);
        vec3 inv_height_color = vec3(1.0 - nheight, 1.0 - nheight, 1.0 - nheight);

        // turn the appropriate channels on
        //
        vec3 color_source = norm_color * rgb_f +
                            class_color * class_f +
                            map_color * map_f +
                            inv_map_color * imap_f;

        vec3 intensity_source = intensity_color * intensity_f +
                                height_color * height_f +
                                inv_height_color * iheight_f;

        // blend and return
        gl_PointSize = pointSize;
        col = vec4(mix(color_source, intensity_source, intensityBlend), 1.0);
    }
</script>
<script type="x-shader/x-fragment" id="fragmentshader">
    uniform vec4 planes[6];
    uniform int do_plane_clipping;

    varying vec4 col;
    varying vec3 fpos;

    void main() {
        if (do_plane_clipping > 0) {
            for(int i = 0 ; i < 6 ; i ++) {
                if (dot(planes[i], vec4(fpos, 1.0)) < 0.0)
                    discard;
            }
        }

        gl_FragColor = col;
    }
</script>
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-48519660-1', 'plas.io');
    ga('send', 'pageview');

</script>
</body>
</html>